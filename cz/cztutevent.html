<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=windows-1250">
  <link rel="stylesheet" type="text/css" href="tutor.css" >
  <link rel="stylesheet" type="text/css" href="colors.css" >
  <title>Jak se nauèit programovat: Událostmi øízené programy</title>
</head>
<body>

<p class="ir">Níe uvedenı text pochází z prvního vydání. Nad tímto textem 
se nachází aktuální stav po revizi smìøující k druhému vydání.</p>

<h2>Událostmi øízené programování</h2>

<p>Zatím jsme se zabıvali pouze dávkovì orientovanımi programy. Vzpomeòte
si, e programy mohou bıt <a href="cztutwhat.html#batch_oriented"
><em>dávkovì orientované</em></a> &mdash; tyto programy jsou spuštìny, nìco
udìlají a skonèí &mdash; nebo <a href="cztutwhat.html#event_driven"
><em>øízené událostmi</em></a> &mdash; ty jsou spuštìny, èekají na vıskyt
<em>události</em>, <span class="trnote" title="Poznámka pøekladatele">na
kterou nìjak zareagují</span>, a skonèí teprve v pøípadì, kdy je jim to
øeèeno pøíslušnou událostí. Jak tedy vytvoøíme událostmi øízenı program? Na
vìc se podíváme dvìma zpùsoby &mdash; nejdøíve si nasimulujeme prostøedí s
událostmi a potom si vytvoøíme velmi jednoduchı program s grafickım
uivatelskım rozhraním (GUI), kterı pro generování událostí vyuívá
operaèního systému a jeho okolí.</p>

<h3>Simulace cyklu pro zpracování událostí</h3>

<p>Souèástí kadého událostmi øízeného programu je cyklus, ve kterém se
zachytávají vzniklé události a zpracovávají se. Události mohou bıt
generovány operaèním systémem, co je pøípad prakticky všech programù s
grafickım uivatelskım rozhraním, nebo program sám zjišuje, zda nenastávají
urèité události, co se èasto dìje v pøípadech zabudovanıch øídicích
systémù, jako jsou ty, které pouívají fotoaparáty, atd.</p>

<p class="trnote"><b>Poznámka pøekladatele:</b> V uvedeném druhém pøípadì
mùeme také øíci, e události pøicházejí z vnìjšího prostøedí. Podobnım
zdrojem událostí jsou vaše prsty dopadající na klávesy klávesnice nebo pohyb
ruky, kterı je snímán myší. Klávesnice nebo myš pøevádìjí mechanické
události z vnìjšího svìta do podoby elektrickıch signálù uvnitø poèítaèe. Ty
se nakonec pøes vhodná zaøízení dostávají a na úroveò volání podprogramù
operaèního systému. A operaèní systém je pøevede a do podoby datovıch
údajù, které zaøadí do pøíslušné fronty událostí.</p>

<p>Vytvoøíme program, kterı sleduje jedinı typ událostí &mdash; vstup z
klávesnice &mdash; a zpracovává je a do doby, kdy je pøijata ukonèující
událost. V našem pøípadì touto ukonèující událostí bude stisk mezerníku.
Pøíchozí události se budou zpracovávat velmi jednoduchım zpùsobem &mdash;
vytiskneme prostì ASCII kód dané klávesy. Program vytvoøíme v jazyce BASIC, 
protoe nám poskytuje pìknou a snadno pouitelnou funkci pro ètení
jednotlivıch kláves &mdash; funkci <code>INKEY$</code>.</p>

<p>Nejdøíve implementujeme hlavní tìlo programu, které jednoduše zahájí
cyklus, ve kterém se zachycují události. Pokud je rozpoznána platná událost, 
volají se pøíslušné podprogramy její zpracování.</p>

<pre>
<span class="comment">' Deklarujeme podprogramy pro ošetøení událostí.</span>
DECLARE SUB zpracujUdalostKlavesy(k AS STRING)
DECLARE SUB zpracujUdalostUkonceni(k AS STRING)
<span class="comment">
' Nejdøíve smaeme obrazovku a oznámíme uivateli, 
' jak se dá èinnost ukonèit.</span>
CLS
PRINT "Konèí se stiskem mezerníku..."
PRINT
<span class="comment">
' Provádìj nekoneènı cyklus.</span>
WHILE 1
    k$ = INKEY$
    delka = LEN(k$)
    IF delka &lt;&gt; 0 THEN
        <span class="comment">' Pøedej událost ke zpracování pøíslušné funkci.</span>
        IF k$ &lt;&gt; " " THEN
            CALL zpracujUdalostKlavesy(k$)
        ELSE 
            CALL zpracujUdalostUkonceni(k$)
        END IF
    END IF
WEND
</pre>

<p>Povšimnìte si, e se hlavní tìlo nestará o to, co se s událostmi stane.
Události se zde jen rozpoznávají a pøedávají se ke zpracování pøíslušnım
funkcím. Nezávislost zachytávání události na zpùsobu jejího zpracování
patøí ke klíèovım rysùm událostmi øízeného programování.</p>

<p>Nyní mùeme implementovat zmínìné dvì funkce pro zpracování událostí.
První z nich, <code>zpracujUdalostKlavesy</code>, jednoduše vytiskne ASCII
kód znaku, kterı odpovídá stisknuté klávese:</p>

<pre>
SUB zpracujUdalostKlavesy(k AS STRING)
    <span class="comment">' Vytiskni platné znaky</span>
    delka = LEN(k)
    IF delka = 1 THEN <span class="comment">' Jde o jednoduchı znak.</span>
        PRINT ASC(k)
    ELSE
        IF delka = 2 THEN 
            <span class="comment">' Nealfanumerickı znak. Tiskneme kód druhého znaku.</span>
            PRINT ASC(MID$(k, 2, 1))
        END IF
    END IF
END SUB
</pre>

<p>Funkce <code>zpracujUdalostUkonceni</code> je velmi jednoduchá. Jednoduše
ukonèí bìh programu pouitím pøíkazu <code>STOP</code>.</p>

<pre>
SUB zpracujUdalostUkonceni(k AS STRING)
    STOP
END SUB
</pre>

<p>Pokud by uvedenı kód byl vytváøen jako pracovní rámec (framework)
pouívanı v mnoha projektech, pak bychom na jeho zaèátek zaøadili volání
<em>funkce pro inicializaci</em> <span class="trnote" title="Poznámka
pøekladatele">(tedy <em>pro poèáteèní nastavení</em></span> a na jeho konec
volání <em>funkce pro úklid</em> (clean up). Programátor by pak mohl pouít
èást s cyklem <span class="trnote" title="Poznámka pøekladatele">bez zásahù
do kódu</span> a doplnil by jen své vlastní funkce pro inicializaci,
zpracování a pro úklidové práce.</p>

<p>Pøesnì tak to dìlá vìtšina prostøedí, orientovanıch na grafické
uivatelské rozhraní (GUI). Smyèka zpráv je souèástí operaèního prostøedí
<span class="trnote" title="Poznámka pøekladatele">(jádra operaèního
systému)</span> nebo programátorského prostøedí (framework). Aplikace jsou
<em>smluvnì zavázány</em> k tomu, aby poskytly funkce pro obsluhu událostí a
nìjakım zpùsobem je <em>navázaly</em> na kód smyèky zpráv.</p>

<p>Ukame si to prakticky pøi souèasném seznámení se s knihovnou Tkinter,
která se dodává se systémem Python.</p>

<h3 id="Tkinter_example">Program s grafickım uivatelskım rozhraním</h3>

<p>V tomto pøíkladu pouijeme nástrojovou sadu <span class="trnote"
title="Poznámka pøekladatele">(toolkit [túlkit])</span> zvanou Tkinter,
která se dodává se systémem Python. Jde o obal (wrapper), vytvoøenı pro
jazyk Python a obalující originální nástrojovou sadu zvanou Tk, která byla
pùvodnì napsána jako rozšíøení k Tcl a která je dostupná i pro jazyk Perl.
Verze pro Python má podobu objektovì orientovaného programátorského
prostøedí (framework), které se &mdash; podle mého názoru &mdash; pouívá
mnohem snadnìji, ne pùvodní procedurální podoba Tk. Nebudu zde pøíliš
zabíhat do problematiky grafického uivatelského rozhraní. Chci se spíše
soustøedit na styl programování &mdash; na to, jak s pouitím Tkinter
pracovat se smyèkou událostí, jak musí programátor vytvoøit grafické
uivatelské rozhraní a jak se zpracovávají pøíchozí události.</p>

<p>V pøíkladu vytvoøíme aplikaèní tøídu <code>KlavesovaAplikace</code>,
která v rámci metody <code>__init__</code> vytvoøí grafické uivatelské
rozhraní a <em>naváe</em> klávesu mezerníku na metodu
<code>zpracujUdalostUkonceni</code>. Tøída definuje i poadovanou metodu
<code>zpracujUdalostUkonceni</code>.</p>

<p>Grafické uivatelské rozhraní se skládá z okna pro textovı vstup (widget
<span class="trnote" title="Poznámka pøekladatele">&mdash; viz <a
href="cztuttrn.html#Pclass_widget" >poznámka</a> k døívìjšímu vıskytu tohoto
pojmu)</span>. Jeho standardní chování spoèívá v opisování zadanıch znakù na
displej, <span class="trnote" title="Poznámka pøekladatele">tedy do plochy
svého okna</span>.</p>

<p>U objektovì orientovanıch prostøedí øízenıch událostmi je vytvoøení tøídy
pro celou aplikaci bìnım zvykem. Je to dáno tím, e mezi konceptem
událostí zasílanıch programu a konceptem zpráv zasílanıch objektù existuje
øada podobností. Oba koncepty se na sebe vzájemnì velmi snadno pøevádìjí.
Funkce pro zpracování událostí se pak stávají metodami aplikaèní tøídy.</p>

<p>Jakmile máme tøídu definovánu, jednoduše vytvoøíme její instanci a
zašleme jí zprávu <code>mainloop</code> <span class="trnote" 
title="Poznámka pøekladatele">([mein lúp], tedy hlavní smyèka &mdash; toto a
další jména nelze ve zdrojovém textu pøeloit do èeského jazyka, protoe jde
o jména, která jsou definována uvnitø Tkinter)</span>.</p>

<p>Kód vypadá následovnì:</p>

<pre>
<span class="comment">
# Pouijeme import ve tvaru 'from X import *', abychom se vyhnuli
# nutnosti zapisovat vše jako 'Tkinter.xxx'.</span>
from Tkinter import *
<span class="comment">
# Vytvoøíme tøídu aplikace, která definuje grafické uivatelské
# rozhraní (GUI) a metody pro zpracování událostí.</span>
class KlavesovaAplikace(Frame):
    def __init__(self):
        Frame.__init__(self)
        self.txtBox = Text(self)
        self.txtBox.bind("&lt;space&gt;", self.zpracujUdalostUkonceni)
        self.txtBox.pack()
        self.pack()

    def zpracujUdalostUkonceni(self, udalost):
        import sys
        sys.exit()
        
<span class="comment">
# Nyní vytvoøíme instanci a nastartujeme smyèku zpráv.</span>
mojeAplikace = KlavesovaAplikace()
mojeAplikace.mainloop()
</pre>

<p>Ve verzi psané v jazyce BASIC jsme samozøejmì tiskli ASCII kódy
odpovídající všem klávesám a neopisovali jsme jenom tisknutelné znaky
odpovídajích kláves, jak to dìláme zde. Ale nic nám nebrání, abychom
zachytávali stisky všech kláves a dìlali pøesnì toté. Za tím úèelem musíme
do metody <code>__init__</code> pøidat následující øádek:</p>

<pre>
self.txtBox.bind("&lt;Key&gt;", self.zpracujStiskKlavesy)
</pre>

<p>Musíme také doplnit následující metodu, pro zpracování odpovídajících
událostí:</p>

<pre>
def zpracujStiskKlavesy(self, udalost):
    str = "%d\n" % udalost.keycode
    self.txtBox.insert(END, str)
    return "break"
</pre>

<p><b>Poznámka 1:</b> Kód klávesy je uloen v poloce <code>keycode</code>
objektu události. Abych to zjistil, musel jsem se podívat do zdrojového kódu
<code>Tkinter.py</code>... Vzpomínáte si, e <a
href="cztutneeds.html#needs_curiosity">zvìdavost</a> patøí ke klíèovım
vlastnostem programátora?</p>

<p><b>Poznámka 2:</b> Pøíkaz <code>return "break"</code> je magickım
signálem pro Tkinter, kterı øíká, e danı prvek (widget) nemá provádìt
standardní (default) zpracování události. Pokud bychom tento øádek neuvedli,
pak by se v textovém oknì zobrazoval ASCII kód a za ním by byl opsán
pøíslušnı znak &mdash; co zde neodpovídá našemu pøání.</p>

<p class="trnote"><b>Poznámka pøekladatele:</b> pokud si chcete hrát s
klávesnicí a podívat se na kódy více kláves, zkuste pøedpis pro pøechod na
novı øádek nahradit napøíklad èárkou a mezerou.</p>

<p>To by pro tuto chvíli staèilo. Vıše uvedenı text, nebyl mínìn jako text
pro vıuku Tkinter. Tím se bude zabıvat téma následující kapitoly. Pouíváním
Tk a Tkinter se zabıvá také nìkolik knih.</p>

<hr>
<div class="foot">
<p class="navig">[ 
<a href="cztutname.html" title="Jména...">pøedchozí</a> |
<a href="cztutcont.html">obsah</a> | 
<a href="cztutgui.html" title="Programování grafického uivatelského rozhraní">další</a> 
]</p>
<p class="note">Pokud vás napadne, co by se dalo na pøekladu této kapitoly
vylepšit, zašlete e-mail odklepnutím

<script type="text/javascript">
var id = new String('$Id: cztutevent.html,v 1.5 2004/08/31 11:55:13 prikryl Exp $');
var ma = new String('prikryl at skil dot cz');
ma = ma.replace(/ at /, '@');
ma = ma.replace(/ dot /, '.');
document.write('<a href="mailto:' + ma + '?subject=JNP2:%20poznamka' 
               + '&body=Dokument:%20' + id.replace(/\s/g, '%20') 
               + '%0d%0dPoznámky:%0d" '
               + 'title="Tento odkaz spustí váš program pro zasílání pošty."'
               + '>tohoto odkazu<' + '/a>.');
</script> 

Tím budou do dopisu automaticky vloeny informace o tomto HTML dokumentu.</p>

<p class="cvs">$Id: cztutevent.html,v 1.5 2004/08/31 11:55:13 prikryl Exp $</p>
</div>
</body>
</html>

